<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Texto a Voz - Pr√°ctica de Ingl√©s</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2575fc;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #2575fc;
        }
        
        .readonly {
            background-color: #f9f9f9;
            color: #666;
        }
        
        .controls {
            background-color: #f0f5ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .control-item {
            flex: 1;
            min-width: 150px;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        
        .range-value {
            display: inline-block;
            width: 40px;
            text-align: center;
            font-weight: 600;
            color: #2575fc;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .playback-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .playback-btn {
            background: linear-gradient(to right, #2575fc, #6a11cb);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(37, 117, 252, 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .playback-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(37, 117, 252, 0.4);
        }
        
        .playback-btn:active {
            transform: translateY(0);
        }
        
        .playback-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .playback-btn.active {
            background: linear-gradient(to right, #ff6b6b, #ff8e53);
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
        }
        
        button {
            background: linear-gradient(to right, #2575fc, #6a11cb);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(37, 117, 252, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 117, 252, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .toggle-button {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            padding: 10px 20px;
            font-size: 14px;
            margin: 10px 0;
        }
        
        .example {
            background-color: #e8f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-style: italic;
            border-left: 4px solid #2575fc;
        }
        
        .status {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            min-height: 24px;
            color: #2575fc;
        }
        
        .progress-info {
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
        
        .phrases-container {
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .phrases-header {
            background-color: #2575fc;
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .phrases-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .phrases-content.expanded {
            max-height: 300px;
        }
        
        .phrases-list {
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .phrase-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .phrase-item:hover {
            background-color: #f0f5ff;
        }
        
        .phrase-item.active {
            background-color: #e3f2fd;
            border-left: 4px solid #2575fc;
        }
        
        .phrase-item:last-child {
            border-bottom: none;
        }
        
        .phrase-text {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .phrase-guide {
            font-size: 0.9em;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .hidden {
            display: none;
        }
        
        .toggle-container {
            text-align: center;
            margin: 15px 0;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .control-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .playback-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .playback-btn {
                width: 100%;
                max-width: 200px;
            }
            
            button {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Conversor de Texto a Voz</h1>
    <p class="subtitle">Practica tu pronunciaci√≥n en ingl√©s</p>
    
    <div class="container">
        <div class="toggle-container">
            <button id="toggle-textareas" class="toggle-button">Mostrar Cajas de Texto</button>
        </div>
        
        <div class="input-group hidden" id="english-textarea">
            <label for="text-input">Texto en ingl√©s (para convertir a voz):</label>
            <textarea id="text-input" rows="3" placeholder="Escribe o pega aqu√≠ la frase en ingl√©s que quieres escuchar...">Who gets to choose the next show, you or me?</textarea>
        </div>
        
        <div class="input-group hidden" id="guide-textarea">
            <label for="guide-input">Caja de gu√≠a (para notas o traducci√≥n):</label>
            <textarea id="guide-input" rows="3" class="readonly" placeholder="Aqu√≠ puedes colocar notas, traducci√≥n, o recordatorios..." readonly>¬øQui√©n elige la siguiente serie para ver, t√∫ o yo?</textarea>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="voice-select">Voz:</label>
                    <select id="voice-select">
                        <option value="">Cargando voces...</option>
                    </select>
                </div>
                <div class="control-item">
                    <label for="rate">Velocidad: <span id="rate-value" class="range-value">1.0</span></label>
                    <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-item">
                    <label for="pitch">Tono: <span id="pitch-value" class="range-value">1.0</span></label>
                    <input type="range" id="pitch" min="0.5" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <label for="volume">Volumen: <span id="volume-value" class="range-value">1.0</span></label>
                    <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
                </div>
            </div>
        </div>
        
        <div class="playback-controls">
            <button id="prev-btn" class="playback-btn">‚óÄ Previous</button>
            <button id="play-btn" class="playback-btn">‚ñ∂Ô∏è Play</button>
            <button id="pause-btn" class="playback-btn">‚è∏Ô∏è Pause</button>
            <button id="next-btn" class="playback-btn">Next ‚ñ∂</button>
            <button id="shuffle-btn" class="playback-btn">üîÄ Shuffle</button>
            <button id="play-all-btn" class="playback-btn">üîÅ Play All</button>
        </div>
        
        <div class="progress-info" id="progress-info">-</div>
        
        <div class="status" id="status"></div>
        
        <div class="phrases-container">
            <div class="phrases-header" id="phrases-toggle">
                <span>Frases desde Google Sheets</span>
                <span id="toggle-icon">‚ñº</span>
            </div>
            <div class="phrases-content" id="phrases-content">
                <div class="phrases-list" id="phrases-list">
                    <div class="loading">Cargando frases...</div>
                </div>
            </div>
        </div>
        
        <div class="example">
            <p><strong>Ejemplo de uso:</strong> Selecciona una frase de la lista o usa los controles de reproducci√≥n para navegar entre las frases y practicar tu pronunciaci√≥n.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos del DOM
            const textInput = document.getElementById('text-input');
            const guideInput = document.getElementById('guide-input');
            const voiceSelect = document.getElementById('voice-select');
            const rateInput = document.getElementById('rate');
            const rateValue = document.getElementById('rate-value');
            const pitchInput = document.getElementById('pitch');
            const pitchValue = document.getElementById('pitch-value');
            const volumeInput = document.getElementById('volume');
            const volumeValue = document.getElementById('volume-value');
            const status = document.getElementById('status');
            const phrasesToggle = document.getElementById('phrases-toggle');
            const phrasesContent = document.getElementById('phrases-content');
            const phrasesList = document.getElementById('phrases-list');
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleTextareasBtn = document.getElementById('toggle-textareas');
            const englishTextarea = document.getElementById('english-textarea');
            const guideTextarea = document.getElementById('guide-textarea');
            const progressInfo = document.getElementById('progress-info');
            
            // Botones de reproducci√≥n
            const prevBtn = document.getElementById('prev-btn');
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const nextBtn = document.getElementById('next-btn');
            const shuffleBtn = document.getElementById('shuffle-btn');
            const playAllBtn = document.getElementById('play-all-btn');
            
            // URL del Google Sheets (formato CSV)
            const sheetsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVT70VI0YmQIOid3mrDfqQEQegpaJXSMiClAZATe0WwWyUeRjYvLYpJRAC_Nda0pMuw_l8GA7YxQ84/pub?output=csv';
            
            // Variables de estado
            let voices = [];
            let phrases = [];
            let currentPhraseIndex = 0;
            let isShuffleMode = false;
            let isPlayingAll = false;
            let shuffleOrder = [];
            
            // Verificar si el navegador soporta la Web Speech API
            if (!('speechSynthesis' in window)) {
                status.textContent = 'Tu navegador no soporta la s√≠ntesis de voz. Por favor, usa Chrome, Edge o Safari.';
                playBtn.disabled = true;
                pauseBtn.disabled = true;
                playAllBtn.disabled = true;
            }
            
            // Cargar las voces disponibles
            function loadVoices() {
                voices = speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';
                
                // Filtrar voces en ingl√©s
                const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));
                
                if (englishVoices.length === 0) {
                    voiceSelect.innerHTML = '<option value="">No se encontraron voces en ingl√©s</option>';
                    return;
                }
                
                // Agrupar voces por g√©nero si es posible
                const femaleVoices = englishVoices.filter(voice => 
                    voice.name.toLowerCase().includes('female') || 
                    voice.name.toLowerCase().includes('woman') ||
                    voice.name.toLowerCase().includes('susan') ||
                    voice.name.toLowerCase().includes('karen') ||
                    voice.name.toLowerCase().includes('zira')
                );
                
                const maleVoices = englishVoices.filter(voice => 
                    voice.name.toLowerCase().includes('male') || 
                    voice.name.toLowerCase().includes('man') ||
                    voice.name.toLowerCase().includes('alex') ||
                    voice.name.toLowerCase().includes('tom') ||
                    voice.name.toLowerCase().includes('victor')
                );
                
                const otherVoices = englishVoices.filter(voice => 
                    !femaleVoices.includes(voice) && !maleVoices.includes(voice)
                );
                
                // Agregar opciones al select
                if (femaleVoices.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Voces femeninas';
                    femaleVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        optgroup.appendChild(option);
                    });
                    voiceSelect.appendChild(optgroup);
                }
                
                if (maleVoices.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Voces masculinas';
                    maleVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        optgroup.appendChild(option);
                    });
                    voiceSelect.appendChild(optgroup);
                }
                
                if (otherVoices.length > 0) {
                    otherVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        voiceSelect.appendChild(option);
                    });
                }
                
                // Seleccionar una voz por defecto (preferiblemente femenina)
                if (femaleVoices.length > 0) {
                    voiceSelect.value = femaleVoices[0].name;
                } else if (maleVoices.length > 0) {
                    voiceSelect.value = maleVoices[0].name;
                } else if (englishVoices.length > 0) {
                    voiceSelect.value = englishVoices[0].name;
                }
            }
            
            // Cargar voces cuando est√©n disponibles
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            
            // Cargar voces inicialmente
            loadVoices();
            
            // Actualizar valores de los rangos
            rateInput.addEventListener('input', () => {
                rateValue.textContent = rateInput.value;
            });
            
            pitchInput.addEventListener('input', () => {
                pitchValue.textContent = pitchInput.value;
            });
            
            volumeInput.addEventListener('input', () => {
                volumeValue.textContent = volumeInput.value;
            });
            
            // Funci√≥n para reproducir el texto
            function speakText(text = null) {
                const textToSpeak = text || textInput.value.trim();
                
                if (textToSpeak === '') {
                    status.textContent = 'Por favor, ingresa un texto para reproducir.';
                    return;
                }
                
                // Detener cualquier s√≠ntesis en curso
                speechSynthesis.cancel();
                
                // Crear el objeto de s√≠ntesis de voz
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                
                // Configurar la voz seleccionada
                const selectedVoice = voices.find(voice => voice.name === voiceSelect.value);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                // Configurar par√°metros
                utterance.rate = parseFloat(rateInput.value);
                utterance.pitch = parseFloat(pitchInput.value);
                utterance.volume = parseFloat(volumeInput.value);
                
                // Eventos para actualizar el estado
                utterance.onstart = () => {
                    status.textContent = 'Reproduciendo...';
                    updatePlaybackButtons(true);
                };
                
                utterance.onend = () => {
                    status.textContent = 'Reproducci√≥n completada.';
                    updatePlaybackButtons(false);
                    
                    // Si estamos reproduciendo todas las frases, pasar a la siguiente
                    if (isPlayingAll) {
                        setTimeout(() => {
                            playNextPhrase();
                        }, 1000);
                    }
                };
                
                utterance.onerror = (event) => {
                    status.textContent = 'Error al reproducir el audio: ' + event.error;
                    updatePlaybackButtons(false);
                    isPlayingAll = false;
                };
                
                // Reproducir
                speechSynthesis.speak(utterance);
            }
            
            // Funci√≥n para actualizar el estado de los botones de reproducci√≥n
            function updatePlaybackButtons(isPlaying) {
                playBtn.disabled = isPlaying;
                pauseBtn.disabled = !isPlaying;
                prevBtn.disabled = isPlaying;
                nextBtn.disabled = isPlaying;
                playAllBtn.disabled = isPlaying;
                
                if (isPlaying) {
                    playBtn.textContent = '‚ñ∂Ô∏è Playing...';
                } else {
                    playBtn.textContent = '‚ñ∂Ô∏è Play';
                }
                
                if (isPlayingAll) {
                    playAllBtn.classList.add('active');
                } else {
                    playAllBtn.classList.remove('active');
                }
            }
            
            // Funci√≥n para cargar una frase espec√≠fica
            function loadPhrase(index) {
                if (phrases.length === 0 || index < 0 || index >= phrases.length) return;
                
                const phrase = phrases[index];
                textInput.value = phrase.Phrase;
                guideInput.value = phrase.Guide || '';
                currentPhraseIndex = index;
                
                // Actualizar la frase activa en la lista
                updateActivePhrase();
                
                // Actualizar informaci√≥n de progreso
                progressInfo.textContent = `Frase ${index + 1} de ${phrases.length}`;
            }
            
            // Funci√≥n para reproducir la frase actual
            function playCurrentPhrase() {
                if (phrases.length === 0) return;
                speakText(phrases[currentPhraseIndex].Phrase);
            }
            
            // Funci√≥n para reproducir la siguiente frase
            function playNextPhrase() {
                if (phrases.length === 0) return;
                
                let nextIndex;
                
                if (isShuffleMode) {
                    // En modo aleatorio, usar el orden pregenerado
                    const currentShuffleIndex = shuffleOrder.indexOf(currentPhraseIndex);
                    nextIndex = shuffleOrder[(currentShuffleIndex + 1) % shuffleOrder.length];
                } else {
                    // En modo normal, siguiente en orden
                    nextIndex = (currentPhraseIndex + 1) % phrases.length;
                }
                
                loadPhrase(nextIndex);
                playCurrentPhrase();
            }
            
            // Funci√≥n para reproducir la frase anterior
            function playPrevPhrase() {
                if (phrases.length === 0) return;
                
                let prevIndex;
                
                if (isShuffleMode) {
                    // En modo aleatorio, usar el orden pregenerado
                    const currentShuffleIndex = shuffleOrder.indexOf(currentPhraseIndex);
                    prevIndex = shuffleOrder[(currentShuffleIndex - 1 + shuffleOrder.length) % shuffleOrder.length];
                } else {
                    // En modo normal, anterior en orden
                    prevIndex = (currentPhraseIndex - 1 + phrases.length) % phrases.length;
                }
                
                loadPhrase(prevIndex);
                playCurrentPhrase();
            }
            
            // Funci√≥n para actualizar la frase activa en la lista
            function updateActivePhrase() {
                const phraseItems = document.querySelectorAll('.phrase-item');
                phraseItems.forEach((item, index) => {
                    if (index === currentPhraseIndex) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }
            
            // Funci√≥n para generar un orden aleatorio
            function generateShuffleOrder() {
                shuffleOrder = [];
                for (let i = 0; i < phrases.length; i++) {
                    shuffleOrder.push(i);
                }
                
                // Algoritmo de Fisher-Yates para mezclar
                for (let i = shuffleOrder.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffleOrder[i], shuffleOrder[j]] = [shuffleOrder[j], shuffleOrder[i]];
                }
            }
            
            // Event listeners para los botones de reproducci√≥n
            playBtn.addEventListener('click', playCurrentPhrase);
            
            pauseBtn.addEventListener('click', () => {
                speechSynthesis.cancel();
                status.textContent = 'Reproducci√≥n pausada.';
                updatePlaybackButtons(false);
                isPlayingAll = false;
            });
            
            nextBtn.addEventListener('click', playNextPhrase);
            
            prevBtn.addEventListener('click', playPrevPhrase);
            
            shuffleBtn.addEventListener('click', () => {
                isShuffleMode = !isShuffleMode;
                if (isShuffleMode) {
                    shuffleBtn.classList.add('active');
                    generateShuffleOrder();
                    status.textContent = 'Modo aleatorio activado.';
                } else {
                    shuffleBtn.classList.remove('active');
                    status.textContent = 'Modo secuencial activado.';
                }
            });
            
            playAllBtn.addEventListener('click', () => {
                if (phrases.length === 0) return;
                
                isPlayingAll = !isPlayingAll;
                
                if (isPlayingAll) {
                    status.textContent = 'Reproduciendo todas las frases...';
                    playCurrentPhrase();
                } else {
                    speechSynthesis.cancel();
                    status.textContent = 'Reproducci√≥n de todas las frases cancelada.';
                    updatePlaybackButtons(false);
                }
            });
            
            // Funci√≥n para parsear CSV correctamente (maneja comas dentro de comillas)
            function parseCSV(csvText) {
                const lines = csvText.split('\n');
                const result = [];
                
                if (lines.length === 0) return result;
                
                // Obtener encabezados
                const headers = parseCSVLine(lines[0]);
                
                // Procesar cada l√≠nea
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = parseCSVLine(lines[i]);
                    const obj = {};
                    
                    // Asignar valores seg√∫n los encabezados
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    
                    result.push(obj);
                }
                
                return result;
            }
            
            // Funci√≥n para parsear una l√≠nea de CSV correctamente
            function parseCSVLine(line) {
                const values = [];
                let currentValue = '';
                let insideQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        // Si estamos dentro de comillas y el siguiente car√°cter tambi√©n es comilla, es una comilla escapada
                        if (insideQuotes && i + 1 < line.length && line[i + 1] === '"') {
                            currentValue += '"';
                            i++; // Saltar la siguiente comilla
                        } else {
                            insideQuotes = !insideQuotes;
                        }
                    } else if (char === ',' && !insideQuotes) {
                        // Fin de un valor - limpiar espacios y comillas sobrantes
                        values.push(currentValue.trim().replace(/^"|"$/g, ''));
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                
                // A√±adir el √∫ltimo valor - limpiar espacios y comillas sobrantes
                values.push(currentValue.trim().replace(/^"|"$/g, ''));
                
                return values;
            }
            
            // Funci√≥n para cargar frases desde Google Sheets
            async function loadPhrasesFromSheets() {
                try {
                    const response = await fetch(sheetsUrl);
                    const csvText = await response.text();
                    
                    // Parsear CSV correctamente
                    phrases = parseCSV(csvText);
                    
                    // Mostrar las frases en la lista
                    displayPhrases(phrases);
                    
                    // Cargar la primera frase si hay frases disponibles
                    if (phrases.length > 0) {
                        loadPhrase(0);
                    }
                    
                } catch (error) {
                    console.error('Error al cargar las frases:', error);
                    phrasesList.innerHTML = '<div class="loading">Error al cargar las frases. Verifica la conexi√≥n a internet.</div>';
                }
            }
            
            // Funci√≥n para mostrar las frases en la lista
            function displayPhrases(phrases) {
                if (phrases.length === 0) {
                    phrasesList.innerHTML = '<div class="loading">No se encontraron frases en el documento.</div>';
                    return;
                }
                
                phrasesList.innerHTML = '';
                
                phrases.forEach((phrase, index) => {
                    // Verificar que la frase tenga contenido
                    if (!phrase.Phrase || phrase.Phrase.trim() === '') return;
                    
                    const phraseItem = document.createElement('div');
                    phraseItem.className = 'phrase-item';
                    if (index === 0) phraseItem.classList.add('active');
                    
                    const phraseText = document.createElement('div');
                    phraseText.className = 'phrase-text';
                    phraseText.textContent = phrase.Phrase;
                    
                    const phraseGuide = document.createElement('div');
                    phraseGuide.className = 'phrase-guide';
                    phraseGuide.textContent = phrase.Guide || 'Sin gu√≠a disponible';
                    
                    phraseItem.appendChild(phraseText);
                    phraseItem.appendChild(phraseGuide);
                    
                    // Al hacer clic en una frase, cargarla en los campos
                    phraseItem.addEventListener('click', () => {
                        loadPhrase(index);
                        // Reproducir autom√°ticamente si hay texto
                        if (phrase.Phrase && phrase.Phrase.trim() !== '') {
                            setTimeout(playCurrentPhrase, 300);
                        }
                    });
                    
                    phrasesList.appendChild(phraseItem);
                });
                
                // Si no se agregaron frases (todas estaban vac√≠as)
                if (phrasesList.children.length === 0) {
                    phrasesList.innerHTML = '<div class="loading">No se encontraron frases v√°lidas en el documento.</div>';
                }
            }
            
            // Toggle para mostrar/ocultar la lista de frases
            let phrasesVisible = false;
            
            phrasesToggle.addEventListener('click', () => {
                phrasesVisible = !phrasesVisible;
                
                if (phrasesVisible) {
                    phrasesContent.classList.add('expanded');
                    toggleIcon.textContent = '‚ñ≤';
                } else {
                    phrasesContent.classList.remove('expanded');
                    toggleIcon.textContent = '‚ñº';
                }
            });
            
            // Toggle para mostrar/ocultar las cajas de texto
            let textareasVisible = false;
            
            function toggleTextareas() {
                textareasVisible = !textareasVisible;
                
                if (textareasVisible) {
                    englishTextarea.classList.remove('hidden');
                    guideTextarea.classList.remove('hidden');
                    toggleTextareasBtn.textContent = 'Ocultar Cajas de Texto';
                } else {
                    englishTextarea.classList.add('hidden');
                    guideTextarea.classList.add('hidden');
                    toggleTextareasBtn.textContent = 'Mostrar Cajas de Texto';
                }
            }
            
            toggleTextareasBtn.addEventListener('click', toggleTextareas);
            
            // Cargar las frases al iniciar
            loadPhrasesFromSheets();
        });
    </script>
</body>
</html>