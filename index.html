<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Texto a Voz - Práctica de Inglés</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-top: 20px;
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-weight: 300;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2575fc;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #2575fc;
        }
        
        .readonly {
            background-color: #f9f9f9;
            color: #666;
        }
        
        .controls {
            background-color: #f0f5ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .control-item {
            flex: 1;
            min-width: 150px;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        
        .range-value {
            display: inline-block;
            width: 40px;
            text-align: center;
            font-weight: 600;
            color: #2575fc;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
        }
        
        button {
            background: linear-gradient(to right, #2575fc, #6a11cb);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(37, 117, 252, 0.4);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 117, 252, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .example {
            background-color: #e8f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-style: italic;
            border-left: 4px solid #2575fc;
        }
        
        .status {
            text-align: center;
            margin-top: 15px;
            font-weight: 600;
            min-height: 24px;
            color: #2575fc;
        }
        
        .phrases-container {
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .phrases-header {
            background-color: #2575fc;
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .phrases-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .phrases-content.expanded {
            max-height: 300px;
        }
        
        .phrases-list {
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .phrase-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .phrase-item:hover {
            background-color: #f0f5ff;
        }
        
        .phrase-item:last-child {
            border-bottom: none;
        }
        
        .phrase-text {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .phrase-guide {
            font-size: 0.9em;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .control-group {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>Conversor de Texto a Voz</h1>
    <p class="subtitle">Practica tu pronunciación en inglés</p>
    
    <div class="container">
        <div class="input-group">
            <label for="text-input">Texto en inglés (para convertir a voz):</label>
            <textarea id="text-input" rows="3" placeholder="Escribe o pega aquí la frase en inglés que quieres escuchar...">Who gets to choose the next show, you or me?</textarea>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="voice-select">Voz:</label>
                    <select id="voice-select">
                        <option value="">Cargando voces...</option>
                    </select>
                </div>
                <div class="control-item">
                    <label for="rate">Velocidad: <span id="rate-value" class="range-value">1.0</span></label>
                    <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-item">
                    <label for="pitch">Tono: <span id="pitch-value" class="range-value">1.0</span></label>
                    <input type="range" id="pitch" min="0.5" max="2" step="0.1" value="1">
                </div>
                <div class="control-item">
                    <label for="volume">Volumen: <span id="volume-value" class="range-value">1.0</span></label>
                    <input type="range" id="volume" min="0" max="1" step="0.1" value="1">
                </div>
            </div>
        </div>
        
        <div class="button-container">
            <button id="speak-button">Reproducir Audio</button>
        </div>
        
        <div class="status" id="status"></div>
        
        <div class="input-group">
            <label for="guide-input">Caja de guía (para notas o traducción):</label>
            <textarea id="guide-input" rows="3" class="readonly" placeholder="Aquí puedes colocar notas, traducción, o recordatorios..." readonly>¿Quién elige la siguiente serie para ver, tú o yo?</textarea>
        </div>
        
        <div class="phrases-container">
            <div class="phrases-header" id="phrases-toggle">
                <span>Frases desde Google Sheets</span>
                <span id="toggle-icon">▼</span>
            </div>
            <div class="phrases-content" id="phrases-content">
                <div class="phrases-list" id="phrases-list">
                    <div class="loading">Cargando frases...</div>
                </div>
            </div>
        </div>
        
        <div class="example">
            <p><strong>Ejemplo de uso:</strong> Selecciona una frase de la lista o escribe tu propia frase en inglés, ajusta la voz y velocidad según tus necesidades, y haz clic en "Reproducir Audio" para escuchar la pronunciación.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos del DOM
            const textInput = document.getElementById('text-input');
            const guideInput = document.getElementById('guide-input');
            const voiceSelect = document.getElementById('voice-select');
            const rateInput = document.getElementById('rate');
            const rateValue = document.getElementById('rate-value');
            const pitchInput = document.getElementById('pitch');
            const pitchValue = document.getElementById('pitch-value');
            const volumeInput = document.getElementById('volume');
            const volumeValue = document.getElementById('volume-value');
            const speakButton = document.getElementById('speak-button');
            const status = document.getElementById('status');
            const phrasesToggle = document.getElementById('phrases-toggle');
            const phrasesContent = document.getElementById('phrases-content');
            const phrasesList = document.getElementById('phrases-list');
            const toggleIcon = document.getElementById('toggle-icon');
            
            // URL del Google Sheets (formato CSV)
            const sheetsUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTVT70VI0YmQIOid3mrDfqQEQegpaJXSMiClAZATe0WwWyUeRjYvLYpJRAC_Nda0pMuw_l8GA7YxQ84/pub?output=csv';
            
            // Verificar si el navegador soporta la Web Speech API
            if (!('speechSynthesis' in window)) {
                status.textContent = 'Tu navegador no soporta la síntesis de voz. Por favor, usa Chrome, Edge o Safari.';
                speakButton.disabled = true;
            }
            
            // Cargar las voces disponibles
            let voices = [];
            
            function loadVoices() {
                voices = speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';
                
                // Filtrar voces en inglés
                const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));
                
                if (englishVoices.length === 0) {
                    voiceSelect.innerHTML = '<option value="">No se encontraron voces en inglés</option>';
                    return;
                }
                
                // Agrupar voces por género si es posible
                const femaleVoices = englishVoices.filter(voice => 
                    voice.name.toLowerCase().includes('female') || 
                    voice.name.toLowerCase().includes('woman') ||
                    voice.name.toLowerCase().includes('susan') ||
                    voice.name.toLowerCase().includes('karen') ||
                    voice.name.toLowerCase().includes('zira')
                );
                
                const maleVoices = englishVoices.filter(voice => 
                    voice.name.toLowerCase().includes('male') || 
                    voice.name.toLowerCase().includes('man') ||
                    voice.name.toLowerCase().includes('alex') ||
                    voice.name.toLowerCase().includes('tom') ||
                    voice.name.toLowerCase().includes('victor')
                );
                
                const otherVoices = englishVoices.filter(voice => 
                    !femaleVoices.includes(voice) && !maleVoices.includes(voice)
                );
                
                // Agregar opciones al select
                if (femaleVoices.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Voces femeninas';
                    femaleVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        optgroup.appendChild(option);
                    });
                    voiceSelect.appendChild(optgroup);
                }
                
                if (maleVoices.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Voces masculinas';
                    maleVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        optgroup.appendChild(option);
                    });
                    voiceSelect.appendChild(optgroup);
                }
                
                if (otherVoices.length > 0) {
                    otherVoices.forEach(voice => {
                        const option = document.createElement('option');
                        option.value = voice.name;
                        option.textContent = `${voice.name} (${voice.lang})`;
                        voiceSelect.appendChild(option);
                    });
                }
                
                // Seleccionar una voz por defecto (preferiblemente femenina)
                if (femaleVoices.length > 0) {
                    voiceSelect.value = femaleVoices[0].name;
                } else if (maleVoices.length > 0) {
                    voiceSelect.value = maleVoices[0].name;
                } else if (englishVoices.length > 0) {
                    voiceSelect.value = englishVoices[0].name;
                }
            }
            
            // Cargar voces cuando estén disponibles
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
            
            // Cargar voces inicialmente
            loadVoices();
            
            // Actualizar valores de los rangos
            rateInput.addEventListener('input', () => {
                rateValue.textContent = rateInput.value;
            });
            
            pitchInput.addEventListener('input', () => {
                pitchValue.textContent = pitchInput.value;
            });
            
            volumeInput.addEventListener('input', () => {
                volumeValue.textContent = volumeInput.value;
            });
            
            // Función para reproducir el texto
            function speakText() {
                if (textInput.value.trim() === '') {
                    status.textContent = 'Por favor, ingresa un texto para reproducir.';
                    return;
                }
                
                // Detener cualquier síntesis en curso
                speechSynthesis.cancel();
                
                // Crear el objeto de síntesis de voz
                const utterance = new SpeechSynthesisUtterance(textInput.value.trim());
                
                // Configurar la voz seleccionada
                const selectedVoice = voices.find(voice => voice.name === voiceSelect.value);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                // Configurar parámetros
                utterance.rate = parseFloat(rateInput.value);
                utterance.pitch = parseFloat(pitchInput.value);
                utterance.volume = parseFloat(volumeInput.value);
                
                // Eventos para actualizar el estado
                utterance.onstart = () => {
                    status.textContent = 'Reproduciendo...';
                    speakButton.disabled = true;
                };
                
                utterance.onend = () => {
                    status.textContent = 'Reproducción completada.';
                    speakButton.disabled = false;
                };
                
                utterance.onerror = (event) => {
                    status.textContent = 'Error al reproducir el audio: ' + event.error;
                    speakButton.disabled = false;
                };
                
                // Reproducir
                speechSynthesis.speak(utterance);
            }
            
            // Asignar evento al botón
            speakButton.addEventListener('click', speakText);
            
            // Permitir reproducir con Enter en el campo de texto
            textInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && event.ctrlKey) {
                    event.preventDefault();
                    speakText();
                }
            });
            
            // Función para parsear CSV correctamente (maneja comas dentro de comillas)
            function parseCSV(csvText) {
                const lines = csvText.split('\n');
                const result = [];
                
                if (lines.length === 0) return result;
                
                // Obtener encabezados
                const headers = parseCSVLine(lines[0]);
                
                // Procesar cada línea
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = parseCSVLine(lines[i]);
                    const obj = {};
                    
                    // Asignar valores según los encabezados
                    headers.forEach((header, index) => {
                        obj[header] = values[index] || '';
                    });
                    
                    result.push(obj);
                }
                
                return result;
            }
            
            // Función para parsear una línea de CSV correctamente
            function parseCSVLine(line) {
    const values = [];
    let currentValue = '';
    let insideQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
            // Si estamos dentro de comillas y el siguiente carácter también es comilla, es una comilla escapada
            if (insideQuotes && i + 1 < line.length && line[i + 1] === '"') {
                currentValue += '"';
                i++; // Saltar la siguiente comilla
            } else {
                insideQuotes = !insideQuotes;
            }
        } else if (char === ',' && !insideQuotes) {
            // Fin de un valor - limpiar espacios y comillas sobrantes
            values.push(currentValue.trim().replace(/^"|"$/g, ''));
            currentValue = '';
        } else {
            currentValue += char;
        }
    }
    
    // Añadir el último valor - limpiar espacios y comillas sobrantes
    values.push(currentValue.trim().replace(/^"|"$/g, ''));
    
    return values;
}
            
            // Función para cargar frases desde Google Sheets
            async function loadPhrasesFromSheets() {
                try {
                    const response = await fetch(sheetsUrl);
                    const csvText = await response.text();
                    
                    // Parsear CSV correctamente
                    const phrases = parseCSV(csvText);
                    
                    // Mostrar las frases en la lista
                    displayPhrases(phrases);
                    
                } catch (error) {
                    console.error('Error al cargar las frases:', error);
                    phrasesList.innerHTML = '<div class="loading">Error al cargar las frases. Verifica la conexión a internet.</div>';
                }
            }
            
            // Función para mostrar las frases en la lista
            function displayPhrases(phrases) {
                if (phrases.length === 0) {
                    phrasesList.innerHTML = '<div class="loading">No se encontraron frases en el documento.</div>';
                    return;
                }
                
                phrasesList.innerHTML = '';
                
                phrases.forEach(phrase => {
                    // Verificar que la frase tenga contenido
                    if (!phrase.Phrase || phrase.Phrase.trim() === '') return;
                    
                    const phraseItem = document.createElement('div');
                    phraseItem.className = 'phrase-item';
                    
                    const phraseText = document.createElement('div');
                    phraseText.className = 'phrase-text';
                    phraseText.textContent = phrase.Phrase;
                    
                    const phraseGuide = document.createElement('div');
                    phraseGuide.className = 'phrase-guide';
                    phraseGuide.textContent = phrase.Guide || 'Sin guía disponible';
                    
                    phraseItem.appendChild(phraseText);
                    phraseItem.appendChild(phraseGuide);
                    
                    // Al hacer clic en una frase, cargarla en los campos
                    phraseItem.addEventListener('click', () => {
                        textInput.value = phrase.Phrase;
                        guideInput.value = phrase.Guide || '';
                        
                        // Reproducir automáticamente si hay texto
                        if (phrase.Phrase && phrase.Phrase.trim() !== '') {
                            setTimeout(speakText, 300);
                        }
                    });
                    
                    phrasesList.appendChild(phraseItem);
                });
                
                // Si no se agregaron frases (todas estaban vacías)
                if (phrasesList.children.length === 0) {
                    phrasesList.innerHTML = '<div class="loading">No se encontraron frases válidas en el documento.</div>';
                }
            }
            
            // Toggle para mostrar/ocultar la lista de frases
            let phrasesVisible = false;
            
            phrasesToggle.addEventListener('click', () => {
                phrasesVisible = !phrasesVisible;
                
                if (phrasesVisible) {
                    phrasesContent.classList.add('expanded');
                    toggleIcon.textContent = '▲';
                } else {
                    phrasesContent.classList.remove('expanded');
                    toggleIcon.textContent = '▼';
                }
            });
            
            // Cargar las frases al iniciar
            loadPhrasesFromSheets();
        });
    </script>
</body>
</html>